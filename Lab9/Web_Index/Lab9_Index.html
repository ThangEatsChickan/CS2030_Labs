<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0057)https://codecrunch.comp.nus.edu.sg/task_view.php?tid=4072 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="expires" content="-1">
<title>CodeCrunch</title>
<!-- START NUS Includes-->
<script type="text/javascript" src="./Lab9_Index_files/nussearch.js.download"></script>
<link rel="stylesheet" type="text/css" href="./Lab9_Index_files/nusbase.css" media="screen, print, projection, handheld">
<link rel="stylesheet" type="text/css" href="./Lab9_Index_files/nusmenu.css" media="screen, print, projection, handheld">
<link rel="stylesheet" type="text/css" href="./Lab9_Index_files/nusscreen.css" media="screen, projection, print">
<link href="https://codecrunch.comp.nus.edu.sg/nus/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon">
<link rel="apple-touch-icon" href="https://codecrunch.comp.nus.edu.sg/nus/blank.png">
<!-- END NUS Includes -->
<script type="text/javascript" src="./Lab9_Index_files/ajax.js.download"></script>
<script type="text/javascript" src="./Lab9_Index_files/jquery-1.8.3.min.js.download"></script>
<script type="text/javascript" src="./Lab9_Index_files/jquery.tablesorter.min.js.download"></script>
<script type="text/javascript" src="./Lab9_Index_files/jquery.tablesorter.pager.js.download"></script>
<!--<script type="text/javascript" src="/js/folding.js"></script>-->
<script type="text/javascript" src="./Lab9_Index_files/jquery.watermark.min.js.download"></script>
<script type="text/javascript">
            function enterPressButton(field, button) {
                $(field).keypress(function(e){if(e.which==13)$(button).trigger("click");});
            }
</script>
<link rel="stylesheet" href="./Lab9_Index_files/style.css" type="text/css">
<link rel="stylesheet" href="./Lab9_Index_files/jquery.tablesorter.css" type="text/css">
<script type="text/javascript" src="./Lab9_Index_files/jquery-1.3.2.min.js.download"></script>
<!--<script type="text/javascript" src="js/folding.js"></script>-->
<script type="text/javascript" src="./Lab9_Index_files/jquery.rating.js.download"></script>
<script type="text/javascript" src="./Lab9_Index_files/behaviour.js.download"></script>
<script type="text/javascript" src="./Lab9_Index_files/textarea_maxlen.js.download"></script>
<script type="text/javascript" src="./Lab9_Index_files/jquery.timer.js.download"></script>

<script type="text/javascript" src="./Lab9_Index_files/plupload.full.min.js.download"></script>

<link rel="stylesheet" href="./Lab9_Index_files/jquery.rating.css" type="text/css">
<link rel="stylesheet" href="./Lab9_Index_files/style.css" type="text/css">
<link rel="stylesheet" href="./Lab9_Index_files/tagcloud.css" type="text/css">
<link rel="stylesheet" href="./Lab9_Index_files/jquery-ui-1.7.2.custom.css" type="text/css">

<link rel="stylesheet" href="./Lab9_Index_files/jquery.ui.plupload.css" type="text/css">

</head>

<body>
<!-- START NUS-Header -->

<!-- NUS Header -->
<div id="nusheader" class="nusbody">
<div class="nuslogodiv">
<a href="http://www.nus.edu.sg/">
<img class="nuslogo" src="./Lab9_Index_files/soclogo.png" alt="">
</a>
</div>
<div id="nuspointermenu">
<ul>
<li><a href="http://exchange.nus.edu.sg/"><span style="text-transform:none">NUS WebMail</span></a></li>
<li><a href="https://ivle.nus.edu.sg/lms/default.aspx">ivle</a></li>
<li><a href="http://www.lib.nus.edu.sg/">library</a></li>
<li><a href="http://www.nus.edu.sg/campusmap/">maps</a></li>
<!--<li><a href="https://aces01.nus.edu.sg/CoE/jsp/coeMain.jsp">calendar</a></li>-->
<!--<li><a href="/sitemap">sitemap</a></li>-->
<!--<li><a href="#">a-z index</a></li>-->
<!--<li><a href="/contact">contact</a></li>-->
<li><a href="https://codecrunch.comp.nus.edu.sg/task_view.php?tid=4072#" id="rightcorner">&nbsp;</a></li>
</ul>
<br style="clear: left">
</div>
<div id="searchform">
<script src="./Lab9_Index_files/nussearch.js.download" type="text/javascript"></script>
<form id="frmSearch" onsubmit="evalSearch();return false" action="https://codecrunch.comp.nus.edu.sg/task_view.php?tid=4072"><div>
<a href="http://www.nus.edu.sg/search/" style="text-decoration:none; font-size:11px; font-weight:bold; color:#666666">Search </a>
<input id="txtKeyword" type="text" value="search for..." onfocus="value=&#39;&#39;" class="equal" size="18">
in
<select id="SearchMenu" name="SearchMenu">
<option selected="selected" value="0">NUS Websites</option>
<option value="1">Internet</option>
<option value="2">Staff Directory</option>
<option value="3">Advanced Search</option>
</select>
<input class="equal" id="Go" src="./Lab9_Index_files/go.png" type="image">
</div></form>
</div>
</div>

<!-- NUS Local-Navigation --><!--
<div id="nusmenu" class="nusbody"><div id="nusmenu_l"><div id="nusmenu_r">
<ul>
  <li><a href="http://www.comp.nus.edu.sg/index.html">Home</a></li>
  <li><a href="http://www.comp.nus.edu.sg/about.html">About Us</a></li>
  <li><a class="drop" href="javascript:;">Departments</a>
    <ul>
      <li><a href="http://www.comp.nus.edu.sg/cs" >Computer Science</a></li>
      <li><a href="http://www.comp.nus.edu.sg/is/" >Information Systems</a></li>
    </ul>
  </li>
  <li><a href="http://www.comp.nus.edu.sg/undergraduates" >Undergraduate</a></li>
  <li><a href="http://www.comp.nus.edu.sg/graduates" >Graduate</a></li>
  <li><a href="http://www.comp.nus.edu.sg/research" >Research</a></li>
  <li><a href="http://www.comp.nus.edu.sg/entrepreneurship" >Entrepreneurship</a></li>
  <li><a href="http://www.stmi.nus.edu.sg" >Executive Education</a></li>
  <li><a href="http://www.comp.nus.edu.sg/external_relations" >External Relations</a></li>
</ul>
</div></div></div>
-->

<!-- NUS Inner-Title -->
<div id="nustitle" class="nusbody"><div id="nustitle_l"><div id="nustitle_r">
              <h1 id="site-name">
                <a href="https://codecrunch.comp.nus.edu.sg/" title="Home" rel="home">CodeCrunch</a>
              </h1>
</div></div></div>

<!-- END NUS-Header -->

<div id="banner">
        <div id="topmenu">
        <div id="login">
                Logged in as: <strong>e0407359</strong>
                </div>
                <div style="display: block;"><ul>
                                        <li><a href="https://codecrunch.comp.nus.edu.sg/index.php">Home</a></li>
                                                    <li><a href="https://codecrunch.comp.nus.edu.sg/course_viewall.php">Courses</a></li>
                                                                <li><a href="https://codecrunch.comp.nus.edu.sg/tutorial_viewall.php">Tutorials</a></li>
                                                                <li><a href="https://codecrunch.comp.nus.edu.sg/task_viewall.php">Tasks</a></li>
                                                                <li><a href="https://codecrunch.comp.nus.edu.sg/tutorial_browser.php">Browse Tutorials</a></li>
                                                                <li><a href="https://codecrunch.comp.nus.edu.sg/user_viewsubmissions.php">My Submissions</a></li>
                                                                <li><a href="https://codecrunch.comp.nus.edu.sg/tools.php">Tools</a></li>
                                                <li><a href="https://codecrunch.comp.nus.edu.sg/logout_process.php">Logout</a></li>
                            </ul></div>
        </div>
</div>
<div id="container">
<div id="outer">
<div id="inner">
	<div id="content_full">                         
		<div class="content-header"><h3>CS2030 Lab #9</h3></div>
		<div class="spacer"></div>
		<table width="100%" cellpadding="0" cellspacing="0" border="0">
			<tbody><tr><td valign="top" style="width: 30%;">
				<div class="meta_header">Tags &amp; Categories</div>
				<div id="classifyList"><span class="value">Tags:
</span>
<span class="value">Categories:
</span></div>
			</td>
			<td valign="top" style="width: 40%;">
				<div class="meta_header">Related Tutorials</div>
				<div id="tutorialList"></div>
			</td>
			<td valign="top" style="width: 30%;">
			</td>
			</tr>
		</tbody></table>
		<div class="content-header">
			<h3>Task Content
							</h3>
		</div>                          
		<div class="panel"><div class="task-content">
		<h3>Matrix Multiplication</h3>

<h4>Problem Description</h4>

<p>Matrix multiplication is a fundamental operation with many applications in physics, engineering, mathematics, and computer science.

</p><p>Given a matrix <tt>A<sub>n×m</sub></tt> of <tt>n</tt> rows by <tt>m</tt> columns, and a matrix <tt>B<sub>m×p</sub></tt>, the matrix product <tt>C<sub>n×p</sub> = AB</tt> is an has elements 
<tt>c<sub>ij</sub></tt> given by 

</p><p><tt>c<sub>ij</sub> = ∑<sup>m</sup><sub style="position: relative; left: -.5em;">k=1</sub></tt>
m<sub>k</sub> = a<sub>ik</sub> b<sub>kj</sub>

</p><p>In this lab, we are interested in parallelizing the following divide-and-conquer algorithm for matrix multiplication.
Let

</p><pre>A = [ A<sub>11</sub> A<sub>12</sub> ]
    [ A<sub>21</sub> A<sub>22</sub> ]

B = [ B<sub>11</sub> B<sub>12</sub> ]
    [ B<sub>21</sub> B<sub>22</sub> ]

C = [ C<sub>11</sub> C<sub>12</sub> ]
    [ C<sub>21</sub> C<sub>22</sub> ]
</pre>

where <tt>A<sub>11</sub></tt>, <tt>A<sub>12</sub></tt>, etc. are block partitioned matrices of <b>equal</b> sizes.

If <tt>C = AB</tt>, then:

<pre>C = [ C<sub>11</sub> C<sub>12</sub> ] 
    [ C<sub>21</sub> C<sub>22</sub> ]

  = [ A<sub>11</sub> A<sub>12</sub> ] [ B<sub>11</sub> B<sub>12</sub> ]
    [ A<sub>21</sub> A<sub>22</sub> ] [ B<sub>21</sub> B<sub>22</sub> ]

  = [ A<sub>11</sub>B<sub>11</sub>+A<sub>12</sub>B<sub>21</sub>  A<sub>11</sub>B<sub>12</sub>+A<sub>12</sub>B<sub>22</sub> ]
    [ A<sub>21</sub>B<sub>11</sub>+A<sub>22</sub>B<sub>21</sub>  A<sub>21</sub>B<sub>12</sub>+A<sub>22</sub>B<sub>22</sub> ]
</pre>

<h4>The Task</h4>

<p>You are to implement the above divide-and-conquer algorithm as a <tt>RecursiveTask</tt> and submit it to <tt>ForkJoinPool</tt> for execution. For simplicity, we only need to handle square matrices of size
<tt>2<sup>n</sup></tt> for <tt>n</tt> up to <tt>11</tt>.

</p><p>A skeleton file <tt><a href="https://codecrunch.comp.nus.edu.sg/taskfile.php/4072/MatrixMultiplication.java">MatrixMultiplication.java</a></tt> has been provided for you. 
The class <tt>MatrixMultiplication</tt> inherits from <tt>RecursiveTask&lt;Matrix&gt;</tt>, with the necessary fields and constructor.
Your task is to complete the <tt>compute</tt> method.

</p><p>The file <tt><a href="https://codecrunch.comp.nus.edu.sg/taskfile.php/4072/Matrix.java">Matrix.java</a></tt> is also provided for you. 
It implements a matrix with <tt>double</tt> values, and stores the values of the matrix in a 2D <tt>double</tt> array <tt>m</tt>. 
It also stores the dimensions of the matrix in the field <tt>dimension</tt>. 
It includes two methods to multiply two matrices, one sequentially with triple for loops, and another (also sequentially) with the recursive divide-and-conquer algorithms. There is a method to compare if two matrices are equal.

</p><p>In addition, the method <tt>parallelMultiply</tt> 
<!--
exists that calls 
-->
invokes the parallel version of matrix multiplication.
At this moment, the method simply calls the non-parallel version of <tt>recursiveMultiply</tt>. 
You are to modify the method to implement the parallel version of recursive matrix multiplication.
<!-- <tt>MatrixMultiplication</tt>. -->

</p><p>The <tt><a href="https://codecrunch.comp.nus.edu.sg/taskfile.php/4072/Main.java">Main</a></tt> driver class is also provided for you which measures the timing runs for a given matrix multiplication task three times before taking the average. 
<!--
It may take around 100-120 seconds to multiply sequentially. 
-->



<!--
<p>This task is divided into several levels.
Read through all the levels 
to see how the different levels are related.
<b>You may start from any level.</b>
-->


<!--
<p>Take note of the following assumptions:
<ul>
<li><b>There is no longer an upper bound for the number of customers</b>;
<li>The format of the input is always correct;
<li>Output of a <tt>double</tt> value, say <tt>d</tt>, is to be formatted with <tt>String.format("%.3f", d)</tt>;
<li>Inconsistencies between sample output and actual output involving <tt>-0.000</tt> and <tt>0.000</tt> can be ignored.

<p>Just remember to

<ul>
<li>define a <tt>Main</tt> class with the <tt>main</tt> method to test the functionality.  <b>Do not accept any user input</b>.
<li>compile your program using
<pre>
$ javac -d . *.java
</pre>

<li>check for output format correctness using the <tt>diff</tt> utility (see specific level for usage details).  Note that only <b>one</b> test case is provided for this;
-->
</p><p>Points to note:
</p><ul>
<li>Find a suitable <tt>FORK_THRESHOLD</tt> for <tt>MatrixMultiplication</tt> such that any matrix dimension smaller than this threshold would be better off using sequential matrix multiplication.

</li><li>Try with small matrices first. Make sure the code is correct before you go for larger matrices.

</li><li>You should not spawn too many tasks that block, which will in turn lead to too many compensation threads being created in <tt>ForkJoinPool</tt>, and a <tt>RejectedExecutionException</tt> being thrown.
<!-- : Caused by: java.util.concurrent.RejectedExecutionException: Thread limit exceeded replacing blocked worker.
The order of fork and join becomes important here.
-->

</li><li>You should not let multiple tasks update the same matrix in place. Such side effects may lead to incorrect results.


<!--
<li>When you debug for correctness and optimize for speed up for the parallel version, there is no need to multiply sequentially three times. Feel free to change this part of the code while you are debugging/optimizing your code.
-->

</li><li>For matrices of dimensions
<tt>2<sup>10</sup></tt>
and
<tt>2<sup>11</sup></tt>
, you need to run <tt>java</tt> with the argument <tt>-Xmx[size]</tt> to increase the heap memory size. For example, <tt>-Xmx1g</tt> increases the heap memory up to 1GB, and should work well for both cases.
That said, you should still not create too many unnecessary copies of the matrices.

</li><li>If you grow impatient while waiting and want to stop the running process, type Control-C in your ssh window. You may have to wait up to a few seconds for the process to stop.
<!--
<li>Check for styling errors by invoking <tt>checkstyle</tt>. For example, to check styling for all java files
<pre>
$ checkstyle *.java
</pre>
-->
<!--
<li>save a copy of all source files into the appropriate level directory (see specific level for usage details).
-->
</li></ul>

<!--
<b>
<ul>
<li>Deadline: Submit your work to CodeCrunch by Thursday, 15 September, 23:59:59.
</ul>
</b>
-->
		</div></div>                          
									<input type="hidden" id="tid" name="tid" value="4072">
		</div>
		<!-- end content -->
</div>
<!-- end inner -->
<div id="loading-mask">
        <p id="loading_mask_loader" class="loader" style="display: none;"> <img alt="Loading..." src="./Lab9_Index_files/ajax-loader-tr.gif"> <br>
                Please wait... </p>
</div>
<script type="text/javascript">
$(".star").rating({
        focus: function(value, link) {
                var tip = $("#rating_text");
                tip[0].data = tip[0].data || tip.html(); 
                tip.html(link.title || "value: " + value);
        },
        blur: function(value, link) {
                var tip = $("#rating_text");
                $("#rating_text").html(tip[0].data || "");
        },
        callback: function(value, link) {
                $.ajax({
                        type: "POST",
                        url: "task_updaterating.php",
                        data: ({tid:$("#tid").val(), rating:value}),
                        success: function(html) {
                                var msg = html.split(";");
                                $("#rating_text").removeClass().addClass(msg[0]);
                                $("#rating_text").html(msg[1]);
                        }
                });
        }
});

function getComments() {
        $.ajax({
                type: "POST",
                url: "task_getcomments.php",
                data: ({tid:$("#tid").val()}),
                success: function(html) {
                        $("#commentList").html(html);
                }
        });
}

function doTaskGrade(e, d) {
        $.ajax({
                type: "POST",
                url: "doTaskGrade.php",
                data: ({tid:$("#tid").val()}),
                success: function(html) {
                        var msg = html.split(";");
                        $("#practiceNotification").removeClass().addClass(msg[0]);
                        $("#practiceNotification").html(msg[1]);
                }
        });

}

function doCourseTaskGrade(e, d) {
        $.ajax({
                type: "POST",
                url: "doTaskGrade.php",
                data: ({tid:$("#tid").val(), course_id:$("#course_id").val(), do_course:1}),
                success: function(html) {
                        var msg = html.split(";");
                        $("#courseNotification").removeClass().addClass(msg[0]);
                        $("#courseNotification").html(msg[1]);
                }
        });

}

function addComment() {
        $.ajax({
                type: "POST",
                url: "task_addcomment.php",
                data: ({tid:$("#tid").val(), comment:encodeURIComponent($("#comment").val())}),
                success: function(html) {
                        var msg = html.split(";");
                        $("#commentNotification").removeClass().addClass(msg[0]);
                        $("#commentNotification").html(msg[1]);
                        
                        getComments();
                }
        });
}

function deleteComment(c) {
        $.ajax({
                type: "POST",
                url: "task_deletecomment.php",
                data: ({comment_id:c}),
                success: function(html) {
                        var msg = html.split(";");
                        $("#commentNotification").removeClass().addClass(msg[0]);
                        $("#commentNotification").html(msg[1]);
                        
                        getComments();
                }
        });
}

function getClassify(){
                $.ajax({
                type: "GET",
                url: "task_classify.php",
                data: ({tid:$("#tid").val()}),
                success: function(html) {
                        $("#classifyList").html(html);
                }
        });
}

function getTutorial(){
        $.ajax({
                type: "POST",
                url: "task_gettutorials.php",
                data: ({tid:$("#tid").val()}),
                success: function(html) {
                        $("#tutorialList").html(html);
                }
        });
}

function getQueries() {
        $.ajax({
                type: "POST",
                url: "task_getqueries.php",
                data: ({tid:$("#tid").val()}),
                success: function(html) {
                        $("#queryList").html(html);
                }
        });
}

function addQuery() {
        $.ajax({
                type: "POST",
                url: "task_addquery.php",
                data: ({tid:$("#tid").val(), contest_id:$("#contest_id").val(), query:encodeURIComponent($("#query").val())}),
                success: function(html) {
                        var msg = html.split(";");
                        $("#queryNotification").removeClass().addClass(msg[0]);
                        $("#queryNotification").html(msg[1]);
                        
                        getQueries();
                }
        });
}

function deleteQuery(q) {
        $.ajax({
                type: "POST",
                url: "task_deletequery.php",
                data: ({query_id:q}),
                success: function(html) {
                        var msg = html.split(";");
                        $("#queryNotification").removeClass().addClass(msg[0]);
                        $("#queryNotification").html(msg[1]);
                        
                        getQueries();
                }
        });
}

function addTag() {
        $.ajax({
                type: "POST",
                url: "tag_add.php",
                data: ({tid:$("#tid").val(), tags:$("#tagwords").val()}),
                success: function(html) {
                        var msg = html.split(";");
                        $("#tagNotification").removeClass().addClass(msg[0]);
                        $("#tagNotification").html(msg[1]);
                        
                        getClassify();
                }
        });
}


$(document).ready(function() {
        getComments();
        getQueries();
        getClassify();
        getTutorial();
        //getCloud();
});

$(document).everyTime(60000, function(i) {
        if ($("#tid").val() != "" && $("#tid").val() != null) {
                $.ajax({
                        type: "POST",
                        url: "task_checkcontest.php",
                        data: ({tid:$("#tid").val()}),
                        success: function(html) {
                                if (html == "0") {
                                        $("#contest_submit").html("");
                                }
                        }
                });
                $.ajax({
                        type: "POST",
                        url: "task_checkcourse.php",
                        data: ({tid:$("#tid").val()}),
                        success: function(html) {
                                if (html == "0") {
                                        $("#course_submit").html("");
                                }
                        }
                });
        }
}, 0);

$('#loading_mask_loader')
        .hide()  // hide it initially
        .ajaxStart(function() {
                $(this).show();
        })
        .ajaxStop(function() {
                $(this).hide();
        });
        
</script>


</div> <!-- end outer -->

</div> <!-- end container -->

<!-- START NUS-Footer --> 
<div id="nusfooter" class="nusbody">
<div id="nusfooter_ml"><div id="nusfooter_mr">
<div id="nusfooter_tc"><div id="nusfooter_tl"><div id="nusfooter_tr">
<div id="nusfooter_bc"><div id="nusfooter_bl"><div id="nusfooter_br">
<div class="inner"><div class="left"><p>© Copyright 2009-2019 National University of Singapore. All Rights Reserved.</p>  
<p class="nusfooterlinks">
<a href="http://www.nus.edu.sg/terms.php">Terms of Use</a> |
<a href="http://www.nus.edu.sg/policy.php">Privacy</a> |
<a href="http://www.nus.edu.sg/nondiscrim.php">Non-discrimination</a></p> 
</div>    
<div class="right">
<a href="https://mysoc.nus.edu.sg/">MySoC</a> |
<a href="https://docs.comp.nus.edu.sg/cf/">Computing Facilities</a> |
<a href="http://www.nus.edu.sg/search/">Search</a> |
<a href="http://www.nus.edu.sg/campusmap/">Campus Map</a>
<p>School of Computing, National University of Singapore</p>
</div>    
<div style="clear: both;"> </div>
</div>
</div></div></div>
</div></div></div>
</div></div>
</div>
<!-- END NUS-Footer -->

</body></html>